# {{ ansible_managed }}
---

services:
{% if tailscale_enable and ts_authkey %}
{% with name='calibre' %}
{% include 'tailscale.yml.j2'%}
{% endwith %}
{% endif %}

 calibre:
    image: lscr.io/linuxserver/calibre:latest
    container_name: calibre
    security_opt:
      - seccomp:unconfined #optional
    environment:
      - PUID={{ puid }}
      - PGID={{ pgid }}
      - TZ={{ timezone }}
      - COUSTOM_USER={{ calibre_username }}
      - PASSWORD={{ calibre_password }}
      - CLI_ARGS={{ calibre_args }}
    volumes:
      - ./config:/config
      - {{ books_dir }}:/books
      - ./certs:/certs
    # ports:
    #   - 8080:8080
    #   - 8181:8181
    #   - 8081:8081
    #   - 9090:9090
    restart: unless-stopped
{% if tailscale_enable and ts_authkey %}
    depends_on:
      - calibre-tailscale
    network_mode: service:calibre-tailscale
{% endif %}
